---
import Layout from '~/layouts/PageLayout_PochomLab_Ja.astro'; // ここも合わせて変更OK

import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const events = await getCollection('events');
  return events
    .filter((e) => e.data.status !== 'draft')
    .map((e) => ({ params: { slug: e.slug }, props: { entry: e } }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);
---
<Layout
  metadata={{
    title: entry.data.title,
    description: 'PochomLab Events',
  }}
>

<article class="py-16">
  <div class="container mx-auto max-w-3xl">
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      {
        entry.data.endDate
          ? `${entry.data.date.toLocaleDateString('ja-JP')} – ${entry.data.endDate.toLocaleDateString('ja-JP')}`
          : entry.data.date.toLocaleDateString('ja-JP')
      }
      {entry.data.location ? ` · ${entry.data.location}` : ''}
    </p>

    <h1 class="mt-2 text-3xl md:text-4xl font-semibold">{entry.data.title}</h1>

    {entry.data.cover && (
      <img
        src={entry.data.cover}
        alt={entry.data.title}
        class="mt-8 rounded-2xl w-full object-cover"
        loading="eager"
        decoding="async"
      />
    )}

    {(entry.data.links?.length || entry.data.lineup?.length) ? (
      <div class="mt-8 rounded-2xl border border-neutral-200/60 dark:border-neutral-800 bg-white/70 dark:bg-neutral-900/50 p-5">
        {entry.data.lineup?.length ? (
          <div>
            <div class="font-medium">Lineup</div>
            <ul class="mt-2 list-disc pl-5 text-neutral-700 dark:text-neutral-200">
              {entry.data.lineup.map((x) => <li>{x}</li>)}
            </ul>
          </div>
        ) : null}

        {entry.data.links?.length ? (
          <div class={entry.data.lineup?.length ? "mt-6" : ""}>
            <div class="font-medium">Links</div>
            <ul class="mt-2 space-y-2">
              {entry.data.links.map((l) => (
                <li>
                  <a class="underline" href={l.url} target="_blank" rel="noreferrer">
                    {l.label}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ) : null}
      </div>
    ) : null}

    <div class="prose dark:prose-invert mt-10">
      <Content />
    </div>
  </div>
</article>

</Layout>
