---
import PageLayout from '~/layouts/PageLayout_PochomLab_Ja.astro';
import { getCollection } from 'astro:content';
import { formatEventDate, isUpcoming, EVENT_TYPE_LABEL } from '~/utils/events';

const all = (await getCollection('events'))
  .filter((e) => !e.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const upcoming = all
  .filter((e) => isUpcoming(e.data.date, e.data.endDate))
  .sort((a, b) => a.data.date.getTime() - b.data.date.getTime());

const past = all
  .filter((e) => !isUpcoming(e.data.date, e.data.endDate))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

//const Card = (e) => e; // å‹ã®éƒ½åˆã§ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼ˆAstroã¯ä¸‹ã§ãã®ã¾ã¾ä½¿ã†ï¼‰
const DEFAULT_EVENT_COVER: Record<string, string> = {
  zine: '/images/events/default-zine.webp',
  online: '/images/events/default-online.webp',
  release: '/images/events/default-release.webp',
  talk: '/images/events/default-talk.webp',
  other: '/images/events/default-other.webp',
};
---

<PageLayout>
  <section class="py-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <h1 class="text-3xl md:text-4xl font-semibold">ğŸ« Events</h1>
      <p class="mt-3 text-neutral-600 dark:text-neutral-300">ãƒªãƒªãƒ¼ã‚¹ã€é ’å¸ƒã€å‚åŠ ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²ã€‚</p>

      {
        upcoming.length ? (
          <div class="mt-12">
            <h2 class="text-xl font-semibold">Upcoming</h2>
            <div class="mt-6 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
              {upcoming.map((e) => (
                <a
                  href={`/ja/events/${e.slug}`}
                  class="group rounded-2xl border border-neutral-200/60 dark:border-neutral-800 bg-white/80 dark:bg-neutral-900/60 hover:shadow-md transition overflow-hidden"
                >
                  <img
                    src={e.data.cover ?? DEFAULT_EVENT_COVER[e.data.type]}
                    alt={e.data.title}
                    class="h-44 w-full object-cover"
                    loading="lazy"
                    decoding="async"
                  />

                  <div class="p-5">
                    <div class="flex items-center gap-2 text-xs">
                      <span class="rounded-full px-2 py-1 bg-neutral-900 text-white dark:bg-white dark:text-neutral-900">
                        {EVENT_TYPE_LABEL[e.data.type] ?? 'EVENT'}
                      </span>
                      <span class="text-neutral-500 dark:text-neutral-400">
                        {formatEventDate(e.data.date, e.data.endDate)}
                      </span>
                    </div>

                    <div class="mt-2 font-medium text-neutral-900 dark:text-neutral-100 group-hover:underline">
                      {e.data.title}
                    </div>

                    {e.data.location ? (
                      <div class="mt-2 text-sm text-neutral-600 dark:text-neutral-300">
                        {e.data.location}
                        {e.data.venue ? ` / ${e.data.venue}` : ''}
                      </div>
                    ) : null}

                    {e.data.tags?.length ? (
                      <div class="mt-3 flex flex-wrap gap-2">
                        {e.data.tags.slice(0, 4).map((t) => (
                          <span class="text-xs rounded-full px-2 py-1 bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-200">
                            {t}
                          </span>
                        ))}
                      </div>
                    ) : null}
                  </div>
                </a>
              ))}
            </div>
          </div>
        ) : null
      }

      {
        past.length ? (
          <div class="mt-14">
            <h2 class="text-xl font-semibold">Past</h2>
            <div class="mt-6 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
              {past.map((e) => (
                <a
                  href={`/ja/events/${e.slug}`}
                  class="group rounded-2xl border border-neutral-200/60 dark:border-neutral-800 bg-white/80 dark:bg-neutral-900/60 hover:shadow-md transition overflow-hidden"
                >
                  <img
                    src={e.data.cover ?? DEFAULT_EVENT_COVER[e.data.type]}
                    alt={e.data.title}
                    class="h-44 w-full object-cover"
                    loading="lazy"
                    decoding="async"
                  />

                  <div class="p-5">
                    <div class="flex items-center gap-2 text-xs">
                      <span class="rounded-full px-2 py-1 bg-neutral-200 text-neutral-800 dark:bg-neutral-800 dark:text-neutral-100">
                        {EVENT_TYPE_LABEL[e.data.type] ?? 'EVENT'}
                      </span>
                      <span class="text-neutral-500 dark:text-neutral-400">
                        {formatEventDate(e.data.date, e.data.endDate)}
                      </span>
                    </div>

                    <div class="mt-2 font-medium text-neutral-900 dark:text-neutral-100 group-hover:underline">
                      {e.data.title}
                    </div>

                    {e.data.location ? (
                      <div class="mt-2 text-sm text-neutral-600 dark:text-neutral-300">
                        {e.data.location}
                        {e.data.venue ? ` / ${e.data.venue}` : ''}
                      </div>
                    ) : null}

                    {e.data.tags?.length ? (
                      <div class="mt-3 flex flex-wrap gap-2">
                        {e.data.tags.slice(0, 4).map((t) => (
                          <span class="text-xs rounded-full px-2 py-1 bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-200">
                            {t}
                          </span>
                        ))}
                      </div>
                    ) : null}
                  </div>
                </a>
              ))}
            </div>
          </div>
        ) : null
      }
    </div>
  </section>
</PageLayout>
